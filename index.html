<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

	<title>jo/quilt @ GitHub</title>
	
	<style type="text/css">
		body {
  		margin-top: 1.0em;
  		background-color: white;
		  font-family: "Helvetica,Arial,FreeSans"; 
  		color: #000000;
    }
    #container {
      margin: 0 auto;
      width: 700px;
    }
		h1 { font-size: 3.8em; color: #07182c; margin-bottom: 3px; }
		h1 .small { font-size: 0.4em; }
		h1 a { text-decoration: none }
		h2 { font-size: 1.5em; color: #07182c; }
    h3 { text-align: center; color: #07182c; }
    a { color: #07182c; }
    .description { font-size: 1.2em; margin-bottom: 30px; margin-top: 30px; font-style: italic;}
    .download { float: right; }
		pre, code { background: #feffea; border: 1px solid #acacac; color: #333}
		code { padding: 3px 5px;}
		pre { padding: 15px;}
    hr { border: 0; width: 80%; border-bottom: 1px solid #aaa}
    .footer { text-align:center; padding-top:30px; font-style: italic; }
    ol li { margin-bottom: 1ex; }
	</style>
	
</head>

<body>
  <a href="http://github.com/jo/quilt"><img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub" /></a>
  
  <div id="container">

    <div class="download">
      <a href="http://github.com/jo/quilt/zipball/master">
        <img border="0" width="90" src="http://github.com/images/modules/download/zip.png"></a>
      <a href="http://github.com/jo/quilt/tarball/master">
        <img border="0" width="90" src="http://github.com/images/modules/download/tar.png"></a>
    </div>
      
    <h1><a href="http://github.com/jo/quilt">Quilt / Couchquilt</a> 
      <span class="small">by <a href="http://github.com/jo">TF</a></span></h1>

    <div class="description">
      Access CouchDB JSON documents from filesystem
    </div>

    <img src="screenshot.png" alt="Screenshot of design document in Futon"/>

    <h2>Get your Quilt</h2>
    <h4>Dependencies</h4>
    <pre>apt-get install ruby rubygems libfusefs-ruby</pre>
    <h4>Installation</h4>
    <p>The preferred way to install Quilt is with Rubygems via Gemcutter:</p>
    <p>
      <pre>gem sources -a http://gemcutter.org/</pre>
      if you havent done that yet.
    </p>
    <pre>gem install couch-quilt</pre>
    <p>
      Or you can download Quilt in either
      <a href="http://github.com/jo/quilt/zipball/master">zip</a> or
      <a href="http://github.com/jo/quilt/tarball/master">tar</a> formats.
    </p>
    <p>You can also clone TFs Quilt with <a href="http://git-scm.com">Git</a>
      by running:
      <pre>$ git clone git://github.com/jo/quilt</pre>
    </p>
    <p>Das wars!</p>

    <h2>Set out your Quilt</h2>
    <p>Just type the following few words:</p>
    <pre>couchquilt http://127.0.0.1:5984 couch_dir</pre>
    <p>Now the databases on <code>http://127.0.0.1:5984</code> are mapped to the (newly created) directory <code>./couch_dir</code>.</p>

    <h2>Sit down on your Couch</h2> 
    <p>Inspect your filesystem at <code>./couch_dir</code> and...</p>
    <p>Relax!</p>

    <p><strong>Tip:</strong> <code>touch _delete</code> will delete a database or document.</p>

    <h2>Digging deeper</h2>

    <p>CouchDB is a document based Database System. The documents are stored in JSON format. Documents can have so called attachements, so CouchDB can easyly store files.</p>
    <p>CouchDB holds application code in Design Documents. These documents are normal CouchDB documents, which have the prefix <code>_design/</code> as id, for example <code>_design/Site</code>.
    Design documents include application code, that is views (Map-Reduce functions), show and list transformations.
    Application Assets, as Images and CSS files, are stored inside design documents as attachements, too.</p>
    
    <p>Quilt maps CouchDB documents to a filesystem, provided by FuseFS.
    Quilt is currently using Ruby to create a Fuse Filesystem.</p>
    
    <p>The CouchDB documents are mapped to a directory structure in the following way:</p>
    
    <ol>
      <li><strong>Databases</strong> are directories in the root folder</li>
      <li>each <strong>Document</strong> is a directory named after the id of the document. Design documents are stored in a subfolder called <code>_design</code></li>
      <li>a <strong>Key</strong> in the hash of the document is a directory inside the documents folder</li>
      <li>the <strong>Value</strong> of the hash lives inside the key folder</li>
      <li><strong>Strings</strong> are plain text files with the extension <code>.js</code></li>
      <li><strong>Booleans</strong> are plain text files with the extension <code>.b.js</code></li>
      <li><strong>Floats</strong> are plain text files with the extension <code>.f.js</code></li>
    
    <li><strong>Integers</strong> are plain text files with the extension <code>.i.js</code></li>
    <li><strong>Arrays</strong> are directories where <em>all</em> elements are numbered, like <code>000</code>, <code>001</code> and <code>002.js</code></li>
    </ol>
    
    <h4>A JSON CouchDB document (design document)</h4>
    <pre>{
   "_id": "_design/Site",
   "_rev": "955-e08d9e52c17159fa1c981202ae6bfcbb",
   "language": "javascript",
   "views": {
       "all": {
           "map": "function(doc) { emit(doc['_id'], 1) }"
       },
       "by_domain": {
           "map": "function(doc) { emit(doc['domain'], 1) }"
       }
   }
}</pre>

    <h4>The corresponding Quilt filesystem</h4>
    <pre>couchdb/
  _design/
    Site/
      _id.js                # _design/Site
      _rev.js               # 955-e08d9e52c17159fa1c981202ae6bfcbb
      _list/
      _show/
      _view/
        all/
          offset.i.js       # 0
          rows/
          total_rows.i.js   # 0
        by_domain/
          offset.i.js       # 0
          rows/
          total_rows.i.js   # 0
      language.js           # javascript
      views/
        all/
          map.js            # function(doc) { emit(doc['_id'], 1) }
        by_domain/
          map.js            # function(doc) { emit(doc['domain'], 1) }</pre>
    <p>(Here the database had no other documents)</p>

    <h2>Getting involved</h2>
    
    <p>If you share my euphoria on this approach feel free to fork my Quilt and start experimenting with Rubys FuseFS API and CouchDB.</p>
    
    <p>Some resources you might consider as a starting point:</p>
    
    <ul>
      <li><a href="http://rubyforge.org/projects/fusefs/">Ruby FuseFS RubyForge Project Page</a></li>
      <li><a href="http://couchdb.apache.org/">CouchDB Project Page</a></li>
      <li><a href="http://books.couchdb.org/relax/">CouchDB: The Definitive Guide</a></li>
      <li><a href="http://wiki.apache.org/couchdb/HTTP_REST_API">Primary API for accessing the CouchDB store</a></li>
    </ul>


    <h2>Author</h2>
    <p>TF Johannes JÃ¶rg Schmidt &lt;<a href="mailto:schmidt@netzmerk.com">schmidt@netzmerk.com</a>&gt;</p>

      
    <div class="footer">
      get the source code on GitHub : <a href="http://github.com/jo/quilt">jo/quilt</a>
    </div>
    
  </div>

  
</body>
</html>
